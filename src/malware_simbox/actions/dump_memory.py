import platform
import subprocess
import os
from malware_simbox.handler.log_handler import log_errors
from malware_simbox.actions.action import Action

class MemoryDump(Action):

    def __init__(self) -> None:
        super().__init__()


    def run(self) -> None:
        self._create_memory_dump()


    @log_errors
    def _create_memory_dump(self) -> None:
        """Creates a memory dump of the current process on Windows using comsvcs.dll."""

        if platform.system().lower() == "windows":
            dump_path = os.path.join(os.getcwd(), "memdump.dmp")
            subprocess.run([
                "rundll32.exe",
                r"C:\Windows\System32\comsvcs.dll,MiniDump",
                str(os.getpid()),
                dump_path,
                "0x00000002"
            ], check=True)
