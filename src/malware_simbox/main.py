import os
import sys
import logging

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from malware_simbox.handler.log_handler import setup_logging
from malware_simbox.actions.file_encryption import FileEncryption
from malware_simbox.actions.file_activities import FileActivity
from malware_simbox.actions.process_activities import ProcessActivity
from malware_simbox.actions.user_creation import UserCreation
from malware_simbox.actions.network_activities import NetworkActivity
from malware_simbox.actions.registry_persistence import RegistryInjection
from malware_simbox.actions.self_replication import SelfReplication
from malware_simbox.actions.dump_memory import MemoryDump


def main():
    setup_logging()

    FileEncryption().run()
    FileActivity().run()
    ProcessActivity().run()
    UserCreation().run(user_name="MalwareAdmin", delete_user=True)
    UserCreation().run(user_name="PMalAdmin", delete_user=False)
    NetworkActivity().run()
    RegistryInjection().run()
    SelfReplication().run()
    MemoryDump().run()

    logging.info("=== END TESTSUITE ===")


# Run the malware simulation
if __name__ == "__main__":
    main()
    
